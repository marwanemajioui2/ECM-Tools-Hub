<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Subnet Round Robin Shuffle - ECM Limits & Stats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Subnet-aware IP shuffler with round-robin allocation for ECM systems">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #1f2937;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f4f6f8;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --text: #111827;
      --text-light: #6b7280;
      --shadow: rgba(0, 0, 0, 0.1);
      --radius: 8px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1300px;
      margin: 0 auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px var(--shadow);
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    h1 {
      font-size: 2.2rem;
      color: var(--secondary);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .subtitle {
      color: var(--text-light);
      font-size: 1.1rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .input-section {
      margin-bottom: 25px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--secondary);
    }

    .section-title i {
      color: var(--primary);
    }

    textarea {
      width: 100%;
      min-height: 180px;
      padding: 15px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      border-radius: var(--radius);
      border: 2px solid var(--border);
      resize: vertical;
      transition: var(--transition);
      background: #fafbfc;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .limits-container {
      background: #f8fafc;
      padding: 20px;
      border-radius: var(--radius);
      margin: 25px 0;
      border: 1px solid var(--border);
    }

    .limits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .limit-group {
      background: white;
      padding: 20px;
      border-radius: var(--radius);
      border: 2px solid var(--border);
      transition: var(--transition);
    }

    .limit-group:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .limit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .limit-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .limit-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .limit-input {
      width: 120px;
      padding: 10px 15px;
      border: 2px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      transition: var(--transition);
    }

    .limit-input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .control-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 28px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.2);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: var(--text);
    }

    .btn-secondary:hover {
      background: #d1d5db;
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #0da271;
      transform: translateY(-2px);
    }

    .stats-container {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      padding: 25px;
      border-radius: var(--radius);
      margin: 30px 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--secondary);
    }

    .output-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }

    .output-group {
      background: white;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .output-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 18px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .output-title {
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .output-count {
      background: rgba(255, 255, 255, 0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .output-textarea {
      min-height: 200px;
      margin: 0;
      border: none;
      border-radius: 0;
      background: #fcfdfe;
    }

    .actions-bar {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 10px;
      background: #f8fafc;
      border-top: 1px solid var(--border);
    }

    .action-btn {
      padding: 6px 12px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }

    .action-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .footer-features {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .feature-tag {
      background: #e0f2fe;
      color: var(--primary);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .limits-grid {
        grid-template-columns: 1fr;
      }
      
      .output-section {
        grid-template-columns: 1fr;
      }
      
      .control-buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1><i class="fas fa-random"></i> Subnet Round Robin Shuffle</h1>
    <p class="subtitle">Subnet-aware IP shuffling with intelligent allocation for ECM systems. Randomize IPs while maintaining subnet distribution.</p>
  </header>

  <div class="input-section">
    <div class="section-title">
      <i class="fas fa-list-ol"></i>
      <span>Input IP Addresses</span>
    </div>
    <textarea id="input" placeholder="Enter IP addresses (one per line):
192.168.1.10
192.168.2.4
10.0.0.1
192.168.1.15
192.168.2.20
10.0.0.5"></textarea>
    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
      <span id="input-count">0 IPs entered</span>
      <button class="action-btn" onclick="clearInput()">
        <i class="fas fa-trash-alt"></i> Clear All
      </button>
    </div>
  </div>

  <div class="limits-container">
    <div class="section-title">
      <i class="fas fa-sliders-h"></i>
      <span>Allocation Limits</span>
    </div>
    <div class="limits-grid">
      <div class="limit-group">
        <div class="limit-header">
          <div class="limit-name">
            <i class="fas fa-microchip" style="color: #ef4444;"></i>
            ECM4
          </div>
          <div class="limit-controls">
            <input type="number" id="limit-ecm4" class="limit-input" value="0" min="0">
          </div>
        </div>
        <p style="color: var(--text-light); font-size: 0.9rem;">Maximum IPs to allocate to ECM4</p>
      </div>

      <div class="limit-group">
        <div class="limit-header">
          <div class="limit-name">
            <i class="fas fa-microchip" style="color: #f59e0b;"></i>
            ECM7
          </div>
          <div class="limit-controls">
            <input type="number" id="limit-ecm7" class="limit-input" value="0" min="0">
          </div>
        </div>
        <p style="color: var(--text-light); font-size: 0.9rem;">Maximum IPs to allocate to ECM7</p>
      </div>

      <div class="limit-group">
        <div class="limit-header">
          <div class="limit-name">
            <i class="fas fa-microchip" style="color: #10b981;"></i>
            ECM10
          </div>
          <div class="limit-controls">
            <input type="number" id="limit-ecm10" class="limit-input" value="0" min="0">
          </div>
        </div>
        <p style="color: var(--text-light); font-size: 0.9rem;">Maximum IPs to allocate to ECM10</p>
      </div>
    </div>
  </div>

  <div class="control-buttons">
    <button class="btn btn-primary" onclick="shuffleIPs()">
      <i class="fas fa-random"></i> Shuffle & Allocate
    </button>
    <button class="btn btn-secondary" onclick="fillSampleData()">
      <i class="fas fa-vial"></i> Load Sample Data
    </button>
    <button class="btn btn-success" onclick="copyAllOutputs()">
      <i class="fas fa-copy"></i> Copy All Results
    </button>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-label">
        <i class="fas fa-list"></i>
        Total Input IPs
      </div>
      <div class="stat-value" id="stat-input">0</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">
        <i class="fas fa-check-circle"></i>
        Total Used IPs
      </div>
      <div class="stat-value" id="stat-used">0</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">
        <i class="fas fa-arrow-right"></i>
        Allocation Rate
      </div>
      <div class="stat-value" id="stat-rate">0%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">
        <i class="fas fa-clock"></i>
        Remaining IPs
      </div>
      <div class="stat-value" id="stat-remaining">0</div>
    </div>
  </div>

  <div class="output-section">
    <div class="output-group">
      <div class="output-header">
        <div class="output-title">
          <i class="fas fa-microchip" style="color: #ef4444;"></i>
          ECM4 Allocated IPs
        </div>
        <div class="output-count" id="count-ecm4">0</div>
      </div>
      <textarea id="output-ecm4" class="output-textarea" readonly></textarea>
      <div class="actions-bar">
        <button class="action-btn" onclick="copyOutput('output-ecm4')">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button class="action-btn" onclick="clearOutput('output-ecm4')">
          <i class="fas fa-trash"></i> Clear
        </button>
      </div>
    </div>

    <div class="output-group">
      <div class="output-header">
        <div class="output-title">
          <i class="fas fa-microchip" style="color: #f59e0b;"></i>
          ECM7 Allocated IPs
        </div>
        <div class="output-count" id="count-ecm7">0</div>
      </div>
      <textarea id="output-ecm7" class="output-textarea" readonly></textarea>
      <div class="actions-bar">
        <button class="action-btn" onclick="copyOutput('output-ecm7')">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button class="action-btn" onclick="clearOutput('output-ecm7')">
          <i class="fas fa-trash"></i> Clear
        </button>
      </div>
    </div>

    <div class="output-group">
      <div class="output-header">
        <div class="output-title">
          <i class="fas fa-microchip" style="color: #10b981;"></i>
          ECM10 Allocated IPs
        </div>
        <div class="output-count" id="count-ecm10">0</div>
      </div>
      <textarea id="output-ecm10" class="output-textarea" readonly></textarea>
      <div class="actions-bar">
        <button class="action-btn" onclick="copyOutput('output-ecm10')">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button class="action-btn" onclick="clearOutput('output-ecm10')">
          <i class="fas fa-trash"></i> Clear
        </button>
      </div>
    </div>
  </div>

  <footer>
    <p>Subnet-aware shuffle • User-defined limits • Full statistics • Round-robin allocation</p>
    <div class="footer-features">
      <span class="feature-tag">IP Validation</span>
      <span class="feature-tag">Subnet Detection</span>
      <span class="feature-tag">Random Distribution</span>
      <span class="feature-tag">Real-time Stats</span>
      <span class="feature-tag">One-click Export</span>
    </div>
  </footer>
</div>

<script>
  // Update input count in real-time
  document.getElementById('input').addEventListener('input', updateInputCount);
  
  function updateInputCount() {
    const input = document.getElementById('input').value;
    const count = input.split('\n').filter(line => line.trim()).length;
    document.getElementById('input-count').textContent = `${count} IP${count !== 1 ? 's' : ''} entered`;
  }

  // Sample data for testing
  function fillSampleData() {
    const sampleIPs = `192.168.1.10
192.168.1.15
192.168.1.20
192.168.2.4
192.168.2.8
192.168.2.12
10.0.0.1
10.0.0.5
10.0.0.9
172.16.0.1
172.16.0.10
172.16.0.20`;
    
    document.getElementById('input').value = sampleIPs;
    document.getElementById('limit-ecm4').value = 4;
    document.getElementById('limit-ecm7').value = 4;
    document.getElementById('limit-ecm10').value = 3;
    updateInputCount();
  }

  function clearInput() {
    document.getElementById('input').value = '';
    updateInputCount();
  }

  function copyOutput(outputId) {
    const textarea = document.getElementById(outputId);
    textarea.select();
    document.execCommand('copy');
    showNotification(`${outputId.replace('output-', '').toUpperCase()} IPs copied to clipboard!`);
  }

  function clearOutput(outputId) {
    document.getElementById(outputId).value = '';
    document.getElementById(`count-${outputId.replace('output-', '')}`).textContent = '0';
    updateStats();
  }

  function copyAllOutputs() {
    const outputs = ['output-ecm4', 'output-ecm7', 'output-ecm10'];
    let allText = '';
    
    outputs.forEach(id => {
      const name = id.replace('output-', '').toUpperCase();
      const content = document.getElementById(id).value;
      if (content.trim()) {
        allText += `${name}:\n${content}\n\n`;
      }
    });
    
    if (allText.trim()) {
      navigator.clipboard.writeText(allText);
      showNotification('All outputs copied to clipboard!');
    } else {
      showNotification('No data to copy!', 'warning');
    }
  }

  function showNotification(message, type = 'success') {
    // Remove existing notification
    const existing = document.querySelector('.notification');
    if (existing) existing.remove();
    
    // Create new notification
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
      ${message}
    `;
    
    // Style the notification
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? 'var(--success)' : 'var(--warning)'};
      color: white;
      padding: 15px 25px;
      border-radius: var(--radius);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
    
    // Add animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  }

  function roundRobinSubnetFullyRandom(inputText) {
    const input = inputText
      .split('\n')
      .map(v => v.trim())
      .filter(v => {
        // Basic IP validation
        const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
        return ipRegex.test(v) && v.split('.').every(num => parseInt(num) <= 255);
      });

    const groups = {};

    input.forEach(ip => {
      const subnet = ip.split('.').slice(0, 3).join('.');
      if (!groups[subnet]) groups[subnet] = [];
      groups[subnet].push(ip);
    });

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    Object.values(groups).forEach(shuffle);

    const subnets = Object.keys(groups);
    const result = [];

    let added = true;
    while (added) {
      added = false;
      for (const subnet of subnets) {
        if (groups[subnet].length > 0) {
          result.push(groups[subnet].shift());
          added = true;
        }
      }
    }

    return result;
  }

  function updateStats() {
    const inputIPs = document.getElementById('input').value
      .split('\n')
      .map(v => v.trim())
      .filter(Boolean);
    
    const ecm4 = document.getElementById('output-ecm4').value.split('\n').filter(Boolean);
    const ecm7 = document.getElementById('output-ecm7').value.split('\n').filter(Boolean);
    const ecm10 = document.getElementById('output-ecm10').value.split('\n').filter(Boolean);
    
    const totalInput = inputIPs.length;
    const totalUsed = ecm4.length + ecm7.length + ecm10.length;
    const remaining = totalInput - totalUsed;
    const rate = totalInput > 0 ? Math.round((totalUsed / totalInput) * 100) : 0;
    
    document.getElementById('stat-input').textContent = totalInput;
    document.getElementById('stat-used').textContent = totalUsed;
    document.getElementById('stat-remaining').textContent = remaining;
    document.getElementById('stat-rate').textContent = `${rate}%`;
  }

  function shuffleIPs() {
    const rawInput = document.getElementById('input').value;
    
    if (!rawInput.trim()) {
      showNotification('Please enter some IP addresses!', 'warning');
      return;
    }

    const shuffled = roundRobinSubnetFullyRandom(rawInput);
    
    if (shuffled.length === 0) {
      showNotification('No valid IP addresses found!', 'warning');
      return;
    }

    const limits = {
      ECM4: parseInt(document.getElementById('limit-ecm4').value) || 0,
      ECM7: parseInt(document.getElementById('limit-ecm7').value) || 0,
      ECM10: parseInt(document.getElementById('limit-ecm10').value) || 0
    };

    const ECM4 = [];
    const ECM7 = [];
    const ECM10 = [];

    let index = 0;

    function take(target, limit) {
      while (target.length < limit && index < shuffled.length) {
        target.push(shuffled[index++]);
      }
    }

    take(ECM4, limits.ECM4);
    take(ECM7, limits.ECM7);
    take(ECM10, limits.ECM10);

    // Update outputs
    document.getElementById('output-ecm4').value = ECM4.join('\n');
    document.getElementById('output-ecm7').value = ECM7.join('\n');
    document.getElementById('output-ecm10').value = ECM10.join('\n');

    // Update counts
    document.getElementById('count-ecm4').textContent = ECM4.length;
    document.getElementById('count-ecm7').textContent = ECM7.length;
    document.getElementById('count-ecm10').textContent = ECM10.length;

    // Update stats
    updateStats();
    
    // Show success message
    const totalUsed = ECM4.length + ECM7.length + ECM10.length;
    showNotification(`Successfully allocated ${totalUsed} IPs across 3 systems!`);
  }

  // Initialize
  updateInputCount();
  updateStats();
</script>

</body>
</html>